{% extends 'base.html.twig' %}

{% block title %}Immeuble
{% endblock %}

{% block body %}
	<div class="float-end">
		<button class="btn btn-light no-print" type="button">
			<a class=" text-decoration-underline-remove" href="{{ path('immeuble_edit', {'IDImmeuble': immeuble.IDImmeuble}) }}">edit</a>
		</button>
		<button class="btn btn-light no-print" type="button" onclick="printImmeuble(); ">
			<a class=" text-decoration-underline-remove">Print</a>
		</button>
	</div>
	<form>
		<div class="form-group row">
			<label for="readOnlyInput" class="col-sm-4 col-form-label fw-bold">Référence Proprietaire :
			</label>
			<div class="col-sm-4">
				<input type="text" readonly class="form-control-plaintext fw-bold" id="staticEmail" value="{{ immeuble.ReferenceProprio }}">
			</div>
		</div>

	</form>
	<h1 style="background:linear-gradient(50deg, rgb(255, 254, 254) 24%, rgb(9, 211, 170) 100%);">
		{{ immeuble.Adresse }}
	</h1>

	<ul class="nav nav-tabs" role="tablist">
		<li class="nav-item" role="presentation">
			<a class="nav-link active" data-bs-toggle="tab" href="#home" aria-selected="true" role="tab" tabindex="-1">Général</a>
		</li>
		<li class="nav-item" role="presentation">
			<a class="nav-link " data-bs-toggle="tab" href="#piece_jointe" aria-selected="true" role="tab">Pièce jointe</a>
		</li>
	</ul>
	<div id="myTabContent" class="tab-content">
		<div class="tab-pane fade active show" id="home" role="tabpanel">
			<br>
			<form>
				<div class="form-group row">
					<label for="readOnlyInput" class="col-sm-4 col-form-label fw-bold">ID Immeuble :
					</label>
					<div class="col-sm-4">
						<input type="text" readonly class="form-control-plaintext fw-bold" id="staticEmail" value="{{ immeuble.IDImmeuble }}">
					</div>
				</div>
			</form>
			<br>
			<div class="accordion" id="accordionExample">
				<div class="accordion-item">
					<h2 class="accordion-header" id="headingOne">
						<button class="accordion-button fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
							Situation
						</button>
					</h2>
					<div id="collapseOne" style="padding:2%" class="accordion-collapse collapse show" aria-labelledby="headingOne" data-bs-parent="#accordionExample" style="">
						<div class="accordion-body">
							<div class="form-group row justify-content-around">
								<div class="col-md-4 mb-3">
									<label for="readOnlyInput">N° Planche Cadastrale</label>
									<input class="form-control" id="readOnlyInput" type="text" placeholder="{{ immeuble.NumPlancheCadastrale }}" readonly="">
								</div>

								<div class="col-md-4 mb-3">
									<label class="form-check-label" for="dateEnquete">
										Date de l'enquête
									</label>
									<input class="form-control" id="dateEnquete" type="text" placeholder="{{ immeuble.DateEnquete ? immeuble.DateEnquete|date('Y-m-d') : '' }}" readonly="">
								</div>
							</div>
						</div>
					</div>
				</div>
				<div class="accordion-item">
					<h2 class="accordion-header" id="headingTwo">
						<button class="accordion-button fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
							Complément
						</button>
					</h2>
					<div id="collapseTwo" style="padding:2%" class="accordion-collapse collapse show" aria-labelledby="headingTwo" data-bs-parent="#accordionExample" style="">
						<form>
							<div class="form-group row justify-content-around">
								<div class="col-md-4 mb-3">
									<label for="readOnlyInput">Etat Dossier</label>
									<input class="form-control" id="readOnlyInput" type="text" placeholder="{{ immeuble.EtatDossier }}" readonly="">
								</div>

								<div class="col-md-4 mb-3">
									<label for="readOnlyInput">Enquete</label>
									<input class="form-control" id="readOnlyInput" type="text" placeholder="{{ immeuble.Enquete }}" readonly="">

								</div>

							</div>

							<div class="form-group row justify-content-around">
								<div class="col-md-4 mb-4">
									<label for="readOnlyInput">Description</label>
									<input class="form-control" id="readOnlyInput" type="text" placeholder="{{ immeuble.Description }}" readonly="">
								</div>
								<div class="col-md-4 mb-4">
									<label for="readOnlyInput">Suivi Par</label>
									<input class="form-control " id="readOnlyInput" type="text" placeholder="{{ immeuble.SuiviPar }}" readonly="">
								</div>
							</div>
							<div class="form-group row justify-content-around">
								<div class="col-md-4 mb-4">
									<label for="readOnlyInput">Origine Contact</label>
									<input class="form-control" id="readOnlyInput" type="text" placeholder="{{ immeuble.OrigineContact }}" readonly="">
								</div>
								<div class="col-md-4 mb-4">
									<label for="readOnlyInput">Intermediaire</label>
									<input class="form-control " id="readOnlyInput" type="text" placeholder="{{ immeuble.Intermediaire }}" readonly="">
								</div>
							</div>
							<hr>
							<div class="form-group row justify-content-around">
								<div class="col-md-1 mb-3">
									<label for="flexCheckDefault">Visité</label>
									{% if immeuble.Visite == 0 %}
										<input class="form-check-input" type="checkbox" disabled="" value="{{ immeuble.Visite }}" id="flexCheckDefault">
									{% elseif immeuble.Visite == 1 %}
										<input class="form-check-input" type="checkbox" disabled="" value="{{ immeuble.Visite }}" checked id="flexCheckDefault">
									{% endif %}
								</div>
								<div class="col-md-1 mb-3">
									<label for="readOnlyInput">Vendu</label>
									{% if immeuble.Vendu == 0 %}
										<input class="form-check-input" type="checkbox" disabled="" value="{{ immeuble.Vendu }}" id="flexCheckDefault">
									{% elseif immeuble.Vendu == 1 %}
										<input class="form-check-input" type="checkbox" disabled="" value="{{ immeuble.Vendu }}" checked id="flexCheckDefault">
									{% endif %}
								</div>
								<div class="col-md-1 mb-3">
									<label for="flexCheckDefault">NCPCF</label>
									{% if immeuble.NCPCF == 0 %}
										<input class="form-check-input" type="checkbox" disabled="" value="{{ immeuble.NCPCF }}" id="flexCheckDefault">
									{% elseif immeuble.NCPCF == 1 %}
										<input class="form-check-input" type="checkbox" disabled="" value="{{ immeuble.NCPCF }}" checked id="flexCheckDefault">
									{% endif %}
								</div>
							</div>
						</form>
					</div>
				</div>
				<div class="accordion-item">
					<h2 class="accordion-header" id="headingThree">
						<button class="accordion-button fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
							Commentaire
						</button>
					</h2>
					<div id="collapseThree" style="padding:2%" class="accordion-collapse collapse show" aria-labelledby="headingThree" data-bs-parent="#accordionExample" style="">
						<div class="form-group row">
							<div class="col-md-12 mb-3">
								<textarea class="form-control" id="exampleTextarea" rows="3" readonly="">{{ immeuble.Commentaire }}</textarea>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="tab-pane" id="piece_jointe" role="tabpanel">
			<div class="row">
				<div class="col-6">
					<h3 class="text-light bg-infos mt-4 text-center">Image</h3>
					<div class="container">
						<div class="row justify-content-center">
							{% for image in immeuble.images %}
								<div class="col-6 d-flex ">
									<div class="card border-info mb-3" style="max-width: 20rem;">
										<div class="card-body">
											<a target="_blank" href="{{ asset('/uploads/img/immeuble/'~image.name) }}">
												<img class="w-100" src="{{ asset('/uploads/img/immeuble/'~image.name) }}" alt="">
											</a>
										</div>
										<button type="button" class="btn btn-danger w-25 mx-auto">
											<a href="{{ path('immeubles_delete_img', {id: image.id})}}" data-delete data-token="{{ csrf_token('delete' ~ image.id )}}" class="text-white">
												<i class="bi bi-trash3"></i>
											</a>
										</button>
									</div>
								</div>
							{% endfor %}
						</div>
					</div>
				</div>
				<div class="col-6 float-right">
					<h3 class="text-light bg-infos mt-4 text-center">PDF</h3>
					<ul class="list-group">
						{% for document in immeuble.documents %}
							<li class="list-group-item list-group-item-primary d-flex justify-content-between align-items-center text-center">
								<button type="button" class="btn btn-primary float-end me-2">
									<a target="_blank" href="{{ asset('/uploads/doc/immeuble/' ~ document.name) }}" alt="PDF de l'immeuble" class="text-white">
										<span class="badge bg-primary rounded-pill fs-4">
											<i class="fa-solid fa-file"></i>
										</span>
									</a>
								</button>
								{{ document.name }}
								<button type="button" class="btn btn-danger float-end">
									<a href="{{ path('immeubles_delete_doc', {id: document.id})}}" data-delete data-token="{{ csrf_token('delete' ~ document.id )}}" class="text-white">
										<i class="bi bi-trash3"></i>
									</a>
								</button>
							</li>
							{# On ajoute un lien permettant de supprimer une image (sera géré en Ajax) #}
						{% endfor %}
					</ul>
				</div>
			</div>
		</div>
		<br>

		<ul class="nav nav-tabs navigationMenu" role="tablist">
			<li class="nav-item" role="presentation">
				<a class="nav-link active" data-bs-toggle="tab" href="#adresses" aria-selected="true" role="tab" tabindex="-1">Adresses</a>
			</li>
			<li class="nav-item" role="presentation">
				<a class="nav-link " data-bs-toggle="tab" href="#contact" aria-selected="true" role="tab">Contact</a>
			</li>
			<li class="nav-item" role="presentation">
				<a class="nav-link " data-bs-toggle="tab" href="#activites" aria-selected="true" role="tab">Activites</a>
			</li>
			<li class="nav-item" role="presentation">
				<a class="nav-link " data-bs-toggle="tab" href="#opportunites" aria-selected="true" role="tab">Opportunites</a>
			</li>
		</ul>

		<div id="myTabContents" class="tab-content">
			<div class="tab-pane fade active show" id="adresses" role="tabpanel">
				<table id="tableImmeuble" data-pagination="true" data-toolbar="#toolbarImmeuble" data-page-size="25" data-search="true" data-show-export="true" data-toggle="table" data-click-to-select="true" data-search-align="left" data-show-columns="true" data-show-print="true" class="table table-list table-bordered table-striped m-auto">
					<thead>
						<tr>
							<th data-field="id" data-sortable="true" scope="col">ID</th>
							<th data-field="numPrincipal" data-sortable="true" scope="col">N°</th>
							<th data-field="typeVoie" data-sortable="true" scope="col">Type de Voie</th>
							<th data-field="adresse" data-sortable="true" scope="col">Adresse</th>
							<th data-field="cp" data-sortable="true" scope="col">CP</th>
							<th data-field="ville" data-sortable="true" scope="col">Ville</th>
							<th data-field="adressePrincipale" data-sortable="true" scope="col">Adresse Principale</th>
							<th data-field="action">Actions</th>
						</tr>
					</thead>
					<tbody class="table-group-divider">
						<h3 class="d-none text-center">Adresse</h3>
						{% for adresse in adresses %}
							<tr class='clickable-row' data-href="{{ path('adresse_show', {'IDAdresse': adresse.IDAdresse}) }}">
								<td>{{ adresse.IDAdresse }}</td>
								<td>{{ adresse.NumPrincipal }}</td>
								<td>{{ adresse.TypeVoie }}</td>
								<td>{{ adresse.Adresse }}</td>
								<td>{{ adresse.CP }}</td>
								<td>{{ adresse.Ville }}</td>
								{% if adresse.AdressePrincipale == 1 %}
									<td class="text-success">
										<i class="fa-solid fa-check"></i>
									</td>
								{% elseif adresse.AdressePrincipale == 0 %}
									<td class="text-danger">
										<i class="fa-solid fa-xmark"></i>
									</td>
								{% endif %}
								<td>
									<a class="text-decoration-underline-remove" href="{{ path('adresse_show', {'IDAdresse': adresse.IDAdresse}) }}">
										<i class="bi bi-eye" style="margin-right:15px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('adresse_edit', {'IDAdresse': adresse.IDAdresse}) }}">
										<i class="bi bi-pen" style="margin-right:10px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('adresse_delete', {'IDAdresse': adresse.IDAdresse}) }}">
										<i class="bi bi-trash3"></i>
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="tab-pane fade" id="contact" role="tabpanel">
				<table id="tableImmeuble" data-pagination="true" data-toolbar="#toolbarImmeuble" data-page-size="25" data-search="true" data-show-export="true" data-toggle="table" data-click-to-select="true" data-search-align="left" data-show-columns="true" data-show-print="true" class="table table-list table-bordered table-striped m-auto">
					<thead>
						<tr>
							<th data-field="civilite" data-sortable="true" scope="col">Civilite</th>
							<th data-field="nom" data-sortable="true" scope="col">Nom</th>
							<th data-field="prenom" data-sortable="true" scope="col">Prenom</th>
							<th data-field="adresse" data-sortable="true" scope="col">Adresse</th>
							<th data-field="cp" data-sortable="true" scope="col">CP</th>
							<th data-field="ville" data-sortable="true" scope="col">Ville</th>
							<th data-field="tel" data-sortable="true" scope="col">Téléphone</th>
							<th data-field="qualite" data-sortable="true" scope="col">Qualité</th>
							<th data-field="contactP" data-sortable="true" scope="col">P</th>
							<th data-field="npai" data-sortable="true" scope="col">NPAI</th>
							<th data-field="action">Actions</th>
						</tr>
					</thead>
					<tbody class="table-group-divider">
						<h3 class="d-none text-center">Contact</h3>
						{% for contact in contacts %}
							<tr class='clickable-row' data-href="{{ path('contact_show', {'IDContact': contact.IDContact.IDContact}) }}">
								<td>{{ contact.IDContact.Civilite }}</td>
								<td>{{ contact.IDContact.Nom }}</td>
								<td>{{ contact.IDContact.Prenom }}</td>
								<td>{{ contact.IDContact.Adresse }}</td>
								<td>{{ contact.IDContact.CP }}</td>
								<td>{{ contact.IDContact.Ville }}</td>
								<td>{{ contact.IDContact.TelephoneDomicile }}</td>
								<td>{{ contact.Qualite }}</td>
								{% if contact.Principal == 1 %}
									<td class="text-success">
										<i class="fa-solid fa-check"></i>
									</td>
								{% elseif contact.Principal == 0 %}
									<td class="text-danger">
										<i class="fa-solid fa-xmark"></i>
									</td>
								{% endif %}
								{% if contact.IDContact.NPAI == 1 %}
									<td class="text-success">
										<i class="fa-solid fa-check"></i>
									</td>
								{% elseif contact.IDContact.NPAI == 0 %}
									<td class="text-danger">
										<i class="fa-solid fa-xmark"></i>
									</td>
								{% endif %}
								<td>
									<a class="text-decoration-underline-remove" href="{{ path('contact_show', {'IDContact': contact.IDContact.IDContact}) }}">
										<i class="bi bi-eye" style="margin-right:15px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('contact_edit', {'IDContact': contact.IDContact.IDContact}) }}">
										<i class="bi bi-pen" style="margin-right:10px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('contact_delete', {'IDContact': contact.IDContact.IDContact}) }}">
										<i class="bi bi-trash3"></i>
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="tab-pane fade" id="activites" role="tabpanel">
				<div id="toolbarActivite" class="mr-2">
					<button class="btn btn-secondary " style="margin-right:20px" type="button">
						<a class="fs-5" href="{{ path('activite_new', {immeuble}) }}">
							<i class="bi bi-file-earmark-plus"></i>
						</a>
					</button>
				</div>
				<table id="tableImmeuble" data-pagination="true" data-toolbar="#toolbarActivite" data-page-size="25" data-search="true" data-show-export="true" data-toggle="table" data-click-to-select="true" data-search-align="left" data-show-columns="true" data-show-print="true" class="table table-list table-bordered table-striped m-auto">
					<thead>
						<tr>
							<th data-field="date" data-sortable="true" scope="col">Date</th>
							<th data-field="theme" data-sortable="true" scope="col">Thème</th>
							<th data-field="commentaire" data-sortable="true" scope="col" data-width="700">Commentaire</th>
							<th data-field="action" data-sortable="true" scope="col" data-width="200">Action</th>
							<th data-field="actions" data-width="100"></th>
						</tr>
					</thead>
					<tbody class="table-group-divider">
						<h3 class="d-none text-center">Activite</h3>
						{% for activite in activites %}
							<tr class='clickable-row' data-href="{{ path('activite_show', {'IDActivite': activite.IDActivite}) }}">
								<td>{{ activite.DateActivite|date('d-m-Y') }}</td>
								<td>{{ activite.Theme }}</td>
								<td>{{ activite.Commentaire }}</td>
								<td>{{ activite.Action }}</td>
								<td>
									<a class="text-decoration-underline-remove" href="{{ path('activite_show', {'IDActivite': activite.IDActivite}) }}">
										<i class="bi bi-eye" style="margin-right:15px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('activite_edit', {'IDActivite': activite.IDActivite, immeuble}) }}">
										<i class="bi bi-pen" style="margin-right:10px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('activite_delete', {'IDActivite': activite.IDActivite}) }}">
										<i class="bi bi-trash3"></i>
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
			<div class="tab-pane fade" id="opportunites" role="tabpanel">
				<div id="toolbarOpportunite" class="mr-2">
					<button class="btn btn-secondary " style="margin-right:20px" type="button">
						<a class="fs-5" href="{{ path('opportunite_new', {immeuble}) }}">
							<i class="bi bi-file-earmark-plus"></i>
						</a>
					</button>
				</div>
				<table id="tableImmeuble" data-pagination="true" data-toolbar="#toolbarOpportunite" data-page-size="25" data-search="true" data-show-export="true" data-toggle="table" data-click-to-select="true" data-search-align="left" data-show-columns="true" data-show-print="true" class="table table-list table-bordered table-striped m-auto">
					<thead>
						<tr>
							<th data-field="date" data-sortable="true" scope="col">Date</th>
							<th data-field="societe" data-sortable="true" scope="col">Société</th>
							<th data-field="cp" data-sortable="true" scope="col">Commentaire</th>
							<th data-field="action">Actions</th>
						</tr>
					</thead>
					<tbody class="table-group-divider">
						<h3 class="d-none text-center">Opportunite</h3>
						{% for opportunite in opportunites %}
							<tr class='clickable-row' data-href="{{ path('opportunite_show', {'IDOpportunite': opportunite.IDOpportunite}) }}">
								<td>{{ opportunite.Date|date('d-m-Y') }}</td>
								<td>{{ opportunite.SocieteConcernee }}</td>
								<td>{{ opportunite.Commentaire }}</td>
								<td>
									<a class="text-decoration-underline-remove" href="{{ path('opportunite_show', {'IDOpportunite': opportunite.IDOpportunite}) }}">
										<i class="bi bi-eye" style="margin-right:15px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('opportunite_edit', {'IDOpportunite': opportunite.IDOpportunite, immeuble}) }}">
										<i class="bi bi-pen" style="margin-right:10px"></i>
									</a>

									<a class="text-decoration-underline-remove" href="{{ path('opportunite_delete', {'IDOpportunite': opportunite.IDOpportunite}) }}">
										<i class="bi bi-trash3"></i>
									</a>
								</td>
							</tr>
						{% endfor %}
					</tbody>
				</table>
			</div>
		</div>
		<br>
		<div class="float-end ">
			<button class="btn btn-light no-print" type="button">
				<a class=" text-decoration-underline-remove" href="{{ path('immeubles') }}">Retourner à la liste</a>
			</button>
		</div>
		<br>
	{% endblock %}
